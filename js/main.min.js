function ViewModel(t,e){"use strict";function n(t){var e=new google.maps.Marker({map:map,position:{lng:t.location.coordinate.longitude,lat:t.location.coordinate.latitude},icon:"https://maps.google.com/mapfiles/ms/icons/blue-dot.png"});e.addListener("click",function(){r(t,e)},!1),t.marker=e,t.show=ko.observable(!0),a.places.push(t)}function r(t,e){map.setCenter(e.getPosition()),e.setAnimation(google.maps.Animation.BOUNCE),setTimeout(function(){e.setAnimation(null)},700),s.getYelpPlace(t.id,e)}function i(t){var e=$("#map"),n=$("#menu");e.toggleClass("map-close"),n.toggleClass("menu-close"),setTimeout(function(){var e=infoWindow.getContent();google.maps.event.trigger(map,"resize"),map.panTo(t),infoWindow.setContent(e)},500)}function o(){function t(){return Math.floor(1e12*Math.random()).toString()}function e(e,n){var r="https://api.yelp.com/v2/business/"+e,i={oauth_consumer_key:o,oauth_token:s,oauth_nonce:t(),oauth_timestamp:Math.floor(Date.now()/1e3),oauth_signature_method:"HMAC-SHA1",oauth_version:"1.0",callback:"cb"},a=oauthSignature.generate("GET",r,i,l,c);i.oauth_signature=a,infoWindow.open(map,n),infoWindow.setContent("Loading Yelp Data..."),map.panTo(n.getPosition()),$.ajax({url:r,data:i,cache:!0,dataType:"jsonp"}).done(function(t){var e='<div class="place-container"><div class="place-image">'+(void 0!==t.image_url?'<img src="'+t.image_url+'"/>':"<div>No image available</div>")+'</div><div class="place-info"><p><strong>Name:</strong> '+(void 0!==t.name?t.name:"N/A")+"</p><p><strong>Phone:</strong> "+(void 0!==t.display_phone?t.display_phone:"N/A")+"</p><p><strong>Rating:</strong> "+(void 0!==t.rating?t.rating:"N/A")+"</p>"+(void 0!==t.url?'<p><a href="'+t.url+'">Find Out More</a></p>':"")+"</div></div>";infoWindow.setContent(e)}).fail(function(t,e){handleError(),infoWindow.setContent("Error loading data.")})}function r(e){i&&4!=i.readyState&&i.abort();var r=map.getCenter(),h="https://api.yelp.com/v2/search",u={oauth_consumer_key:o,oauth_token:s,oauth_nonce:t(),oauth_timestamp:Math.floor(Date.now()/1e3),oauth_signature_method:"HMAC-SHA1",oauth_version:"1.0",callback:"cb",limit:10,term:e,ll:r.lat()+","+r.lng()},p=oauthSignature.generate("GET",h,u,l,c);u.oauth_signature=p,i=$.ajax({url:h,data:u,cache:!0,dataType:"jsonp"}).done(function(t){a.clearPlaces(),t.businesses.forEach(function(t){n(t)})}).fail(function(t,e){"abort"!==e&&handleError()})}var i,o="pV7R7vzUXJEFfl3Dj4retQ",s="VDFoUxGRIq2274OdKt8U-wwvpgnkKtrL",l="t4CQ3YyzkgP26-lDGp1pVoLOFks",c="SB5H01fW3LCNi3qyO7uaJ59DK9U";return{getYelpPlace:e,getYelpPlaces:r}}var a=this,s=new o,l=!1,c=e;a.searchText=ko.observable(t),a.filterText=ko.observable(""),a.places=ko.observableArray([]),a.search=ko.computed(function(){if(""!==a.searchText().trim())if("art gallery"===a.searchText().trim()&&c&&!l){var t;for(t=0;t<defaultPlaces.length;t++)n(defaultPlaces[t]);l=!0}else s.getYelpPlaces(a.searchText().trim());else a.clearPlaces()}),a.filter=ko.computed(function(){var t=new RegExp(a.filterText(),"i");a.places().forEach(function(e){-1==e.name.search(t)?(infoWindow.getPosition()===e.marker.getPosition()&&infoWindow.close(),e.show(!1),e.marker.setVisible(!1)):(e.show(!0),e.marker.setVisible(!0))})}),a.clearPlaces=function(){for(var t=a.places().length,e=0;e<t;e++){a.places().shift().marker.setMap(null)}a.places.removeAll()},a.getYelpInfo=function(t){window.innerWidth<500&&!$("#menu").hasClass("menu-close")&&i(t.marker.getPosition()),r(t,t.marker)},a.toggleMenu=function(){i({lat:userPosition.coords.latitude,lng:userPosition.coords.longitude})}}var CryptoJS=CryptoJS||function(t,e){var n={},r=n.lib={},i=function(){},o=r.Base={extend:function(t){i.prototype=this;var e=new i;return t&&e.mixIn(t),e.hasOwnProperty("init")||(e.init=function(){e.$super.init.apply(this,arguments)}),e.init.prototype=e,e.$super=this,e},create:function(){var t=this.extend();return t.init.apply(t,arguments),t},init:function(){},mixIn:function(t){for(var e in t)t.hasOwnProperty(e)&&(this[e]=t[e]);t.hasOwnProperty("toString")&&(this.toString=t.toString)},clone:function(){return this.init.prototype.extend(this)}},a=r.WordArray=o.extend({init:function(t,e){t=this.words=t||[],this.sigBytes=void 0!=e?e:4*t.length},toString:function(t){return(t||l).stringify(this)},concat:function(t){var e=this.words,n=t.words,r=this.sigBytes;if(t=t.sigBytes,this.clamp(),r%4)for(var i=0;t>i;i++)e[r+i>>>2]|=(n[i>>>2]>>>24-i%4*8&255)<<24-(r+i)%4*8;else if(65535<n.length)for(i=0;t>i;i+=4)e[r+i>>>2]=n[i>>>2];else e.push.apply(e,n);return this.sigBytes+=t,this},clamp:function(){var e=this.words,n=this.sigBytes;e[n>>>2]&=4294967295<<32-n%4*8,e.length=t.ceil(n/4)},clone:function(){var t=o.clone.call(this);return t.words=this.words.slice(0),t},random:function(e){for(var n=[],r=0;e>r;r+=4)n.push(4294967296*t.random()|0);return new a.init(n,e)}}),s=n.enc={},l=s.Hex={stringify:function(t){var e=t.words;t=t.sigBytes;for(var n=[],r=0;t>r;r++){var i=e[r>>>2]>>>24-r%4*8&255;n.push((i>>>4).toString(16)),n.push((15&i).toString(16))}return n.join("")},parse:function(t){for(var e=t.length,n=[],r=0;e>r;r+=2)n[r>>>3]|=parseInt(t.substr(r,2),16)<<24-r%8*4;return new a.init(n,e/2)}},c=s.Latin1={stringify:function(t){var e=t.words;t=t.sigBytes;for(var n=[],r=0;t>r;r++)n.push(String.fromCharCode(e[r>>>2]>>>24-r%4*8&255));return n.join("")},parse:function(t){for(var e=t.length,n=[],r=0;e>r;r++)n[r>>>2]|=(255&t.charCodeAt(r))<<24-r%4*8;return new a.init(n,e)}},h=s.Utf8={stringify:function(t){try{return decodeURIComponent(escape(c.stringify(t)))}catch(t){throw Error("Malformed UTF-8 data")}},parse:function(t){return c.parse(unescape(encodeURIComponent(t)))}},u=r.BufferedBlockAlgorithm=o.extend({reset:function(){this._data=new a.init,this._nDataBytes=0},_append:function(t){"string"==typeof t&&(t=h.parse(t)),this._data.concat(t),this._nDataBytes+=t.sigBytes},_process:function(e){var n=this._data,r=n.words,i=n.sigBytes,o=this.blockSize,s=i/(4*o),s=e?t.ceil(s):t.max((0|s)-this._minBufferSize,0);if(e=s*o,i=t.min(4*e,i),e){for(var l=0;e>l;l+=o)this._doProcessBlock(r,l);l=r.splice(0,e),n.sigBytes-=i}return new a.init(l,i)},clone:function(){var t=o.clone.call(this);return t._data=this._data.clone(),t},_minBufferSize:0});r.Hasher=u.extend({cfg:o.extend(),init:function(t){this.cfg=this.cfg.extend(t),this.reset()},reset:function(){u.reset.call(this),this._doReset()},update:function(t){return this._append(t),this._process(),this},finalize:function(t){return t&&this._append(t),this._doFinalize()},blockSize:16,_createHelper:function(t){return function(e,n){return new t.init(n).finalize(e)}},_createHmacHelper:function(t){return function(e,n){return new p.HMAC.init(t,n).finalize(e)}}});var p=n.algo={};return n}(Math);!function(){var t=CryptoJS,e=t.lib,n=e.WordArray,r=e.Hasher,i=[],e=t.algo.SHA1=r.extend({_doReset:function(){this._hash=new n.init([1732584193,4023233417,2562383102,271733878,3285377520])},_doProcessBlock:function(t,e){for(var n=this._hash.words,r=n[0],o=n[1],a=n[2],s=n[3],l=n[4],c=0;80>c;c++){if(16>c)i[c]=0|t[e+c];else{var h=i[c-3]^i[c-8]^i[c-14]^i[c-16];i[c]=h<<1|h>>>31}h=(r<<5|r>>>27)+l+i[c],h=20>c?h+(1518500249+(o&a|~o&s)):40>c?h+(1859775393+(o^a^s)):60>c?h+((o&a|o&s|a&s)-1894007588):h+((o^a^s)-899497514),l=s,s=a,a=o<<30|o>>>2,o=r,r=h}n[0]=n[0]+r|0,n[1]=n[1]+o|0,n[2]=n[2]+a|0,n[3]=n[3]+s|0,n[4]=n[4]+l|0},_doFinalize:function(){var t=this._data,e=t.words,n=8*this._nDataBytes,r=8*t.sigBytes;return e[r>>>5]|=128<<24-r%32,e[14+(r+64>>>9<<4)]=Math.floor(n/4294967296),e[15+(r+64>>>9<<4)]=n,t.sigBytes=4*e.length,this._process(),this._hash},clone:function(){var t=r.clone.call(this);return t._hash=this._hash.clone(),t}});t.SHA1=r._createHelper(e),t.HmacSHA1=r._createHmacHelper(e)}(),function(){var t=CryptoJS,e=t.enc.Utf8;t.algo.HMAC=t.lib.Base.extend({init:function(t,n){t=this._hasher=new t.init,"string"==typeof n&&(n=e.parse(n));var r=t.blockSize,i=4*r;n.sigBytes>i&&(n=t.finalize(n)),n.clamp();for(var o=this._oKey=n.clone(),a=this._iKey=n.clone(),s=o.words,l=a.words,c=0;r>c;c++)s[c]^=1549556828,l[c]^=909522486;o.sigBytes=a.sigBytes=i,this.reset()},reset:function(){var t=this._hasher;t.reset(),t.update(this._iKey)},update:function(t){return this._hasher.update(t),this},finalize:function(t){var e=this._hasher;return t=e.finalize(t),e.reset(),e.finalize(this._oKey.clone().concat(t))}})}(),function(){var t=CryptoJS,e=t.lib.WordArray;t.enc.Base64={stringify:function(t){var e=t.words,n=t.sigBytes,r=this._map;t.clamp(),t=[];for(var i=0;n>i;i+=3)for(var o=(e[i>>>2]>>>24-i%4*8&255)<<16|(e[i+1>>>2]>>>24-(i+1)%4*8&255)<<8|e[i+2>>>2]>>>24-(i+2)%4*8&255,a=0;4>a&&n>i+.75*a;a++)t.push(r.charAt(o>>>6*(3-a)&63));if(e=r.charAt(64))for(;t.length%4;)t.push(e);return t.join("")},parse:function(t){var n=t.length,r=this._map,i=r.charAt(64);i&&-1!=(i=t.indexOf(i))&&(n=i);for(var i=[],o=0,a=0;n>a;a++)if(a%4){var s=r.indexOf(t.charAt(a-1))<<a%4*2,l=r.indexOf(t.charAt(a))>>>6-a%4*2;i[o>>>2]|=(s|l)<<24-o%4*8,o++}return e.create(i,o)},_map:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/="}}(),window.url=function(){function t(t){return!isNaN(parseFloat(t))&&isFinite(t)}return function(e,n){var r=n||window.location.toString();if(!e)return r;e=e.toString(),"//"===r.substring(0,2)?r="http:"+r:1===r.split("://").length&&(r="http://"+r),n=r.split("/");var i={auth:""},o=n[2].split("@");1===o.length?o=o[0].split(":"):(i.auth=o[0],o=o[1].split(":")),i.protocol=n[0],i.hostname=o[0],i.port=o[1]||("https"===i.protocol.split(":")[0].toLowerCase()?"443":"80"),i.pathname=(n.length>3?"/":"")+n.slice(3,n.length).join("/").split("?")[0].split("#")[0];var a=i.pathname;"/"===a.charAt(a.length-1)&&(a=a.substring(0,a.length-1));var s=i.hostname,l=s.split("."),c=a.split("/");if("hostname"===e)return s;if("domain"===e)return/^(([0-9]|[1-9][0-9]|1[0-9]{2}|2[0-4][0-9]|25[0-5])\.){3}([0-9]|[1-9][0-9]|1[0-9]{2}|2[0-4][0-9]|25[0-5])$/.test(s)?s:l.slice(-2).join(".");if("sub"===e)return l.slice(0,l.length-2).join(".");if("port"===e)return i.port;if("protocol"===e)return i.protocol.split(":")[0];if("auth"===e)return i.auth;if("user"===e)return i.auth.split(":")[0];if("pass"===e)return i.auth.split(":")[1]||"";if("path"===e)return i.pathname;if("."===e.charAt(0)){if(e=e.substring(1),t(e))return e=parseInt(e,10),l[0>e?l.length+e:e-1]||""}else{if(t(e))return e=parseInt(e,10),c[0>e?c.length+e:e]||"";if("file"===e)return c.slice(-1)[0];if("filename"===e)return c.slice(-1)[0].split(".")[0];if("fileext"===e)return c.slice(-1)[0].split(".")[1]||"";if("?"===e.charAt(0)||"#"===e.charAt(0)){var h=r,u=null;if("?"===e.charAt(0)?h=(h.split("?")[1]||"").split("#")[0]:"#"===e.charAt(0)&&(h=h.split("#")[1]||""),!e.charAt(1))return h;e=e.substring(1),h=h.split("&");for(var p=0,d=h.length;d>p;p++)if(u=h[p].split("="),u[0]===e)return u[1]||"";return null}}return""}}(),"undefined"!=typeof jQuery&&jQuery.extend({url:function(t,e){return window.url(t,e)}}),function(){"use strict";function t(){}function e(t,e,s){s=new o(s).get(),this._httpMethod=new n(t).get(),this._url=new r(e).get(),this._parameters=new i(s).get(),this._rfc3986=new a}function n(t){this._httpMethod=t||""}function r(t){this._url=t||""}function i(t){this._parameters=t||{},this._sortedKeys=[],this._normalizedParameters=[],this._rfc3986=new a,this._sortParameters(),this._concatenateParameters()}function o(t){this._parameters={},this._loadParameters(t||{})}function a(){}function s(t,e,n){this._rfc3986=new a,this._text=t,this._key=this._rfc3986.encode(e)+"&"+this._rfc3986.encode(n),this._base64EncodedHash=new l(this._text,this._key).getBase64EncodedHash()}function l(t,e){this._cryptoJS=c?require("crypto-js"):CryptoJS,this._text=t||"",this._key=e||"",this._hash=this._cryptoJS.HmacSHA1(this._text,this._key)}var c="undefined"!=typeof module&&void 0!==module.exports;t.prototype.generate=function(t,n,r,i,o,a){var l=new e(t,n,r).generate(),c=!0;return a&&(c=a.encodeSignature),new s(l,i,o).generate(c)},e.prototype={generate:function(){return this._rfc3986.encode(this._httpMethod)+"&"+this._rfc3986.encode(this._url)+"&"+this._rfc3986.encode(this._parameters)}},n.prototype={get:function(){return this._httpMethod.toUpperCase()}},r.prototype={get:function(){if(!this._url)return this._url;-1==this._url.indexOf("://")&&(this._url="http://"+this._url);var t=c?this.parseInNode():this.parseInBrowser(),e=(t.scheme||"http").toLowerCase(),n=(t.authority||"").toLocaleLowerCase(),r=t.path||"",i=t.port||"";(80==i&&"http"==e||443==i&&"https"==e)&&(i="");var o=e+"://"+n;return o+=i?":"+i:"","/"==r&&-1===this._url.indexOf(o+r)&&(r=""),this._url=(e?e+"://":"")+n+(i?":"+i:"")+r,this._url},parseInBrowser:function(){return{scheme:url("protocol",this._url).toLowerCase(),authority:url("hostname",this._url).toLocaleLowerCase(),port:url("port",this._url),path:url("path",this._url)}},parseInNode:function(){var t=require("uri-js"),e=t.parse(this._url),n=e.scheme;return":"==n.charAt(n.length-1)&&(n=n.substring(0,n.length-1)),{scheme:n,authority:e.host,port:e.port,path:e.path}}},i.prototype={_sortParameters:function(){var t,e;for(t in this._parameters)this._parameters.hasOwnProperty(t)&&(e=this._rfc3986.encode(t),this._sortedKeys.push(e));this._sortedKeys.sort()},_concatenateParameters:function(){var t;for(t=0;t<this._sortedKeys.length;t++)this._normalizeParameter(this._sortedKeys[t])},_normalizeParameter:function(t){var e,n,r=this._rfc3986.decode(t),i=this._parameters[r];for(i.sort(),e=0;e<i.length;e++)n=this._rfc3986.encode(i[e]),this._normalizedParameters.push(t+"="+n)},get:function(){return this._normalizedParameters.join("&")}},o.prototype={_loadParameters:function(t){t instanceof Array?this._loadParametersFromArray(t):"object"==typeof t&&this._loadParametersFromObject(t)},_loadParametersFromArray:function(t){var e;for(e=0;e<t.length;e++)this._loadParametersFromObject(t[e])},_loadParametersFromObject:function(t){var e;for(e in t)t.hasOwnProperty(e)&&this._loadParameterValue(e,t[e]||"")},_loadParameterValue:function(t,e){var n;if(e instanceof Array){for(n=0;n<e.length;n++)this._addParameter(t,e[n]);0==e.length&&this._addParameter(t,"")}else this._addParameter(t,e)},_addParameter:function(t,e){this._parameters[t]||(this._parameters[t]=[]),this._parameters[t].push(e)},get:function(){return this._parameters}},a.prototype={encode:function(t){return t?encodeURIComponent(t).replace(/[!'()]/g,escape).replace(/\*/g,"%2A"):""},decode:function(t){return t?decodeURIComponent(t):""}},s.prototype={generate:function(t){return!1===t?this._base64EncodedHash:this._rfc3986.encode(this._base64EncodedHash)}},l.prototype={getBase64EncodedHash:function(){return this._hash.toString(this._cryptoJS.enc.Base64)}};var h=new t;h.SignatureBaseString=e,h.HttpMethodElement=n,h.UrlElement=r,h.ParametersElement=i,h.ParametersLoader=o,h.Rfc3986=a,h.HmacSha1Signature=s,h.HmacSha1=l,c?module.exports=h:window.oauthSignature=h}();var google,map,userPosition,infoWindow,LAT=38.9072,LNG=-77.0369,defaultPlaces=[{id:"national-gallery-of-art-washington",name:"National Gallery of Art",location:{coordinate:{latitude:38.8913416579172,longitude:-77.0198351875512}}},{id:"hirshhorn-museum-and-sculpture-garden-washington-2",name:"Hirshhorn Museum & Sculpture Garden",location:{coordinate:{latitude:38.8875699,longitude:-77.02191}}},{id:"bloombars-washington",name:"BloomBars",location:{coordinate:{latitude:38.930202,longitude:-77.028114}}},{id:"freer-gallery-of-art-and-arthur-m-sackler-gallery-washington",name:"Freer Gallery of Art and Arthur M Sackler Gallery",location:{coordinate:{latitude:38.8875252753496,longitude:-77.0265506207943}}},{id:"the-fridge-washington",name:"The Fridge",location:{coordinate:{latitude:38.88213,longitude:-76.994232}}},{id:"national-gallery-of-art-sculpture-garden-washington-2",name:"National Gallery of Art Sculpture Garden",location:{coordinate:{latitude:38.8912975692515,longitude:-77.022959356414}}},{id:"toro-mata-washington",name:"Toro Mata",location:{coordinate:{latitude:38.92099,longitude:-77.04238}}},{id:"the-smithsonian-institution-washington",name:"The Smithsonian Institution",location:{coordinate:{latitude:38.8889236,longitude:-77.0261612}}},{id:"artists-proof-washington-2",name:"Artist's Proof",location:{coordinate:{latitude:38.910091,longitude:-77.064407}}},{id:"the-phillips-collection-washington-3",name:"The Phillips Collection",location:{coordinate:{latitude:38.911477119043,longitude:-77.0468060633715}}}],initMap=function(){"use strict";function t(t){userPosition=t,map=new google.maps.Map(document.getElementById("map"),{center:{lat:userPosition.coords.latitude,lng:userPosition.coords.longitude},zoom:12,mapTypeControl:!1}),infoWindow=new google.maps.InfoWindow,ko.applyBindings(new ViewModel("art gallery",!1))}function e(t){alert('Showing search results for "art gallery" near default location of Washington DC because we could not access geolocation data'),map=new google.maps.Map(document.getElementById("map"),{center:{lat:LAT,lng:LNG},zoom:12,mapTypeControl:!1}),userPosition={coords:{latitude:LAT,longitude:LNG}},infoWindow=new google.maps.InfoWindow,ko.applyBindings(new ViewModel("art gallery",!0))}navigator.geolocation.getCurrentPosition(t,e)},handleError=function(){alert("Something has gone wrong. Please try refreshing the page.")};window.onerror=function(){handleError()};